<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/user_layout}">
<head>
    <title>로그인</title>
    <link th:href="@{/css/normalize3.css}" rel="stylesheet"/><!--input style-->
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>

<th:block layout:fragment="step-wrap">
    <div class="signin_wrap">
        <form action="/login_check" method="POST">
            <div class="signin">
                <div style="font-size: 1.5rem;font-family: 'TmonMonsori', serif;">
                    <h1>Welcome!</h1>
                    <h3 style="color:gray">This is Sprint Manager Scheduling Program</h3>
                </div>
                <div class="input_wrap">
                    <div class="container">
                        <section class="content bgcolor-4">
          <span class="input input--chisato">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
					<input class="input__field input__field--chisato" type="text" id="userid" name="userid"/>
					<label class="input__label input__label--chisato" for="input-13">
						<span class="input__label-content input__label-content--chisato" data-content="User Id">아이디를 입력하세요</span>
					</label>
				</span>
                            <span class="input input--chisato">
					<input class="input__field input__field--chisato" type="password" id="password" name="password"/>
					<label class="input__label input__label--chisato" for="input-14">
						<span class="input__label-content input__label-content--chisato" data-content="Password">비밀번호를 입력하세요</span>
					</label>
				</span>

                        </section>

                    </div><!-- /container -->


                </div>
                <div style="margin:80px">
                    <section class="color-4">
                        <p>
                            <button class="btn btn-4-pink btn-4a icon-arrow-right-pink" onclick="login();">Sign In
                            </button>
                        </p>

                    </section>
                </div>
            </div>
        </form>
    </div>
</th:block>
<th:block layout:fragment="signup-wrap">
    <h1 style="color:white;">New here?</h1>
    <h4 style="color:white;">Don't have an account?</h4>
    <div style="margin-top:100px;">
        <section class="color-4">
            <p>
                <button class="btn btn-4 btn-4a icon-arrow-right" onclick="location.href='/step1'">Sign up</button>
            </p>
        </section>
    </div>
</th:block>
</html>
<footer>
    <script>
        function valid_check(){
            var userid = $('#userid').val();
            var password = $('#password').val();
            var param = {"userid":userid, "password":password}

            $.ajax({
                contentType: "application/json; charset=utf-8;",
                type: "POST",
                url: "/login_check",
                dataType: "text",
                data: JSON.stringify(param),
                success: function (data) {
                    alert(data);
                }, error: function () {
                    console.log("실패");
                }
            });
        }
        function login(){
            $.ajax({
                url:"/login",
                type :  "POST",
                dataType : "json",
                data : {
                    memberId : $("#member-id").val(),
                    memberPassword : $("#member-password").val()
                },
                beforeSend : function(xhr)
                {
                    //이거 안하면 403 error
                    //데이터를 전송하기 전에 헤더에 csrf값을 설정한다
                    var $token = $("#token");
                    xhr.setRequestHeader($token.data("token-name"), $token.val());
                },
                success : function(response){
                    if(response.code == "200"){
                        // 정상 처리 된 경우
                        window.location = response.item.url;	//이전페이지로 돌아가기
                    } else {
                        alert(response.message);
                    }
                },
                error : function(a,b,c){
                    console.log(a,b,c);
                }

            })

        }
    </script>
</footer>